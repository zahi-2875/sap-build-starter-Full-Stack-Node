const cds = require('../../..')

function cls_aspect(/* module, level, args, toLog */) {
  // actually nothing to do
}

cls_aspect.cf = () => [...cds.env.log.cls_custom_fields]

const vcap_services = JSON.parse(
  process.env.VCAP_SERVICES_FILE_PATH
    ? cds.utils.fs.readFileSync(process.env.VCAP_SERVICES_FILE_PATH, 'utf-8')
    : process.env.VCAP_SERVICES || '{}'
)

module.exports =
  vcap_services['cloud-logging'] ||
  vcap_services['user-provided']?.find(e => e.tags.includes('cloud-logging') || e.tags.includes('Cloud Logging'))
    ? cls_aspect
    : () => {}
